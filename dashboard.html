<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Scan Sampah</title>

<!-- CDN STABLE -->
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.21.0/dist/tf.min.js"></script>
<script src="https://unpkg.com/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>

<style>
body{
margin:0;
font-family:Arial;
background:linear-gradient(135deg,#ffd6c9,#ffb7a5,#ffe5dc);
text-align:center;
}
.header{
background:white;
padding:18px;
box-shadow:0 4px 10px rgba(0,0,0,0.1);
}
.btn{
padding:14px 22px;
border:none;
border-radius:12px;
font-size:16px;
cursor:pointer;
margin:8px;
}
.scan{ background:#4caf50; color:white;}
.logout{ background:#e53935; color:white;}
video,img{
width:320px;
border-radius:16px;
margin-top:15px;
box-shadow:0 8px 20px rgba(0,0,0,0.15);
}
.result{
background:white;
width:420px;
max-width:95%;
margin:auto;
padding:20px;
border-radius:16px;
box-shadow:0 6px 18px rgba(0,0,0,0.1);
font-size:18px;
}
</style>
</head>

<body>

<div class="header">
<h2>üì∑ AI Scan Sampah</h2>
<button class="btn logout" onclick="logout()">Logout</button>
</div>

<video id="video" autoplay playsinline></video>
<canvas id="canvas" hidden></canvas>

<br>

<button class="btn scan" onclick="startCamera()">Aktifkan Kamera</button>
<button class="btn scan" onclick="capture()">Ambil Foto</button>

<br><br>

<input type="file" id="fileInput" accept="image/*">
<br>
<img id="preview">

<br><br>

<button class="btn scan" onclick="predict()">Scan AI</button>

<br><br>

<div class="result" id="resultBox">‚è≥ Menyiapkan AI...</div>

<script>
let model;

const video=document.getElementById("video");
const canvas=document.getElementById("canvas");
const preview=document.getElementById("preview");
const fileInput=document.getElementById("fileInput");
const resultBox=document.getElementById("resultBox");

// ===== LOAD MODEL =====
async function loadModel(){
    try{
        model = await tmImage.load(
            "model/model.json",
            "model/metadata.json"
        );
        resultBox.innerHTML="‚úÖ Model AI siap";
        console.log("MODEL READY");
    }catch(e){
        console.error(e);
        alert("Model gagal load");
    }
}
loadModel();

// ===== CAMERA =====
async function startCamera(){
    const stream=await navigator.mediaDevices.getUserMedia({video:true});
    video.srcObject=stream;
}

// ===== CAPTURE =====
function capture(){
    canvas.width=video.videoWidth;
    canvas.height=video.videoHeight;
    canvas.getContext("2d").drawImage(video,0,0);
    preview.src=canvas.toDataURL("image/png");
}

// ===== FILE =====
fileInput.addEventListener("change",e=>{
    const reader=new FileReader();
    reader.onload=x=>preview.src=x.target.result;
    reader.readAsDataURL(e.target.files[0]);
});

// ===== PREDICT =====
async function predict(){
    if(!model)return alert("Model belum siap");
    if(!preview.src)return alert("Ambil gambar dulu");

    resultBox.innerHTML="üîç Menganalisis...";

    const pred=await model.predict(preview);
    pred.sort((a,b)=>b.probability-a.probability);

    resultBox.innerHTML=`
    <b>${pred[0].className}</b><br>
    Akurasi ${(pred[0].probability*100).toFixed(1)}%
    `;
}

// ===== LOGOUT =====
function logout(){
    localStorage.clear();
    location.href="index.html";
}
</script>

</body>
</html>
